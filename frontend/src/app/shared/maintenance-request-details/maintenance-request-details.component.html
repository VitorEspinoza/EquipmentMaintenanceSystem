<div class="p-4 md:p-8 bg-gray-50 min-h-screen">
  <ng-container *ngIf="request() as data; else loadingOrError">
    <div class="max-w-4xl mx-auto space-y-6">
      <mat-card appearance="outlined">
        <mat-card-header class="!pt-6">
          <mat-card-title class="!text-2xl">{{ data.equipmentDescription }}</mat-card-title>
          <mat-card-subtitle
            >Solicitação #{{ data.id }} &bull; Criada em {{ data.createdAt | date: 'dd/MM/yyyy' }}</mat-card-subtitle
          >
        </mat-card-header>

        <mat-card-content class="!pt-4">
          <div
            class="flex flex-wrap justify-between items-start gap-4 p-4 mb-4 bg-blue-50 rounded-lg border border-blue-200"
          >
            <div>
              <p class="text-sm font-medium text-gray-500 mb-1">Status Atual</p>
              <span class="px-3 py-1 rounded-full text-sm font-semibold" [ngClass]="stateClass()">
                {{ data.state }}
              </span>
            </div>
            <div class="text-right">
              <p class="text-sm font-medium text-gray-500 mb-1">Preço Orçado</p>
              <p class="text-xl font-bold text-gray-800">
                {{ data.quotedValue ? (data.quotedValue | currency: 'BRL') : 'Aguardando orçamento' }}
              </p>
            </div>
          </div>

          <div class="space-y-5">
            <div class="flex items-start gap-4">
              <mat-icon class="text-gray-400 mt-1">description</mat-icon>
              <div>
                <p class="text-sm text-gray-500">Descrição do Defeito</p>
                <p class="text-base font-medium text-gray-900">{{ data.defectDescription || 'Não informado' }}</p>
              </div>
            </div>
            <div *ngIf="data.rejectionReason" class="flex items-start gap-4">
              <mat-icon class="text-red-500 mt-1">gpp_bad</mat-icon>
              <div>
                <p class="text-sm text-red-700">Motivo da Rejeição</p>
                <p class="text-base font-medium text-red-600">{{ data.rejectionReason }}</p>
              </div>
            </div>
          </div>
        </mat-card-content>
        <mat-divider class="mx-4"></mat-divider>
        <mat-card-actions class="!p-4 flex justify-center gap-2">
          <ng-container *ngFor="let action of actions()">
            <button mat-flat-button color="primary" (click)="executeAction(action)">
              {{ action }}
            </button>
          </ng-container>
        </mat-card-actions>
      </mat-card>

      <mat-card appearance="outlined">
        <mat-card-header class="!pt-6">
          <mat-card-title>Histórico de Estados</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <table mat-table [dataSource]="data.stateHistory" class="w-full">
            <ng-container matColumnDef="state">
              <th mat-header-cell *matHeaderCellDef>Estado</th>
              <td mat-cell *matCellDef="let history">{{ history.state }}</td>
            </ng-container>
            <ng-container matColumnDef="changedAt">
              <th mat-header-cell *matHeaderCellDef>Data de Alteração</th>
              <td mat-cell *matCellDef="let history">{{ history.changedAt | date: 'dd/MM/yyyy HH:mm' }}</td>
            </ng-container>
            <ng-container matColumnDef="changedByEmployeeName">
              <th mat-header-cell *matHeaderCellDef>Alterado Por</th>
              <td mat-cell *matCellDef="let history">{{ history.changedByEmployeeName || 'Sistema' }}</td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
          </table>
        </mat-card-content>
      </mat-card>
    </div>
  </ng-container>

  <ng-template #loadingOrError>
    <div class="text-center text-gray-500 font-medium mt-8 p-8 bg-white rounded-lg shadow-md">
      <span>Carregando dados da solicitação...</span>
    </div>
  </ng-template>
</div>
